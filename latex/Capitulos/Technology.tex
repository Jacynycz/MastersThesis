\chapter{Methodology \& Technology}

\begin{FraseCelebre}
  \begin{Frase}
    The needs of the many outweigh the needs of the few
  \end{Frase}
  \begin{Fuente}
    Spock - The Wrath of Khan
  \end{Fuente}
\end{FraseCelebre}

\section{Methodology}

Decentralized Science is based on a project idea outlined in a blockchain event
in September 2017. In this event we were a group of 4 developers with one month
to design an idea of a platform or service using blockchain technologies to
solve a particular problem. This Master's Thesis is a first approach to the
software design and implementation of that project sketch.

\subsection{Project Timeline}
\label{methodology:timeline}


Decentralized Science's project timeline has three different parts:

\begin{itemize}
  \itbf{Pre-project:} \emph{Blockchain for Social Impact} was an online event
  that took place in September 2017. The main goal of that event was to design a
  blockchain-powered platform to solve any social related problem, and the best
  one would receive funding. Me and other partners formed a team to develop the
  first Decentralized Science's idea within the month that the event lasted. In
  this period we had to make a series of deliverables every week to show that we
  were working on one project. In order to make this, the team met 3 times a
  week to design the platform using methodologies such as Brainstorming and
  Value Proposition Canvas. The main idea of the platform and the problems it
  had to solve were identified in this period. Unfortunately the project was not
  one of the winners of the event and the team decided to pause the project.

  \itbf{Project implementation:} Since I was the only one with programming
  knowledge in blockchain, I decided to continue with the project on my own.
  Consequently, and as my Master's Thesis, I started the project's
  implementation and software design from October 2017 until February 2018. To
  achieve this, I used a development system based on agile methodologies such as
  SCRUM and Extreme Programming to be able to develop incremental prototypes as
  a first approach to the platform. During this period I have developed two
  functional prototypes using different blockchain architectures. Afterwards, I
  have tested them to compare the two implementations in terms of performance,
  execution cost and compatibility with other possible platforms. These
  prototypes are developed under an \bb{open source license} and the last
  version is available in Github\footnote{see https://decentralized.science}.
  During this period I had reunions twice a month with my directors to update
  the status of the project. Finally, since January of 2018 I have started this
  manuscript as the master's thesis memory.

  \itbf{Post-project:} From March 2018 the team decided to continue working in
  the project's idea, trying to find supporters and funding to develop a final
  platform. Decentralized Science has been presented in three European
  conferences on blockchain in which several projects were discovered in the
  same field: ETHCC2018 (Paris), SPOBC2018 (Vienna) and PEERE2018 (Rome). In
  addition, Decentralized Science has formed a group with other similar projects
  called Open Science Ecosystem with more than 30 projects regarding open
  science around the world. Currently the team are sending scientific papers to
  different conferences to validate the ideas of this platform with the
  scientific community. One paper has been published in the PEERE2018 conference
  and another has been accepted in a CORE-A conference so far (see
  section~\ref{sec:conferences-papers}). This papers and the feedback received
  by the community allowed me to improve the platform source code and complete
  this manuscript.
  
\end{itemize}

\subsection{Brainstorming}

Brainstorming was born as a method to increase creativity in groups and
organizations. There are only few rules on this method: do not criticize any of
the given ideas, quantity is desired over quality, try to combine suggested
ideas and give all the ideas that come to mind, no matter if they are possible
or not~\cite{osborn1953applied}.

This method is used nowadays in companies and work groups as part of the process
of the creative process of a product, although there are some critics about
brainstorming and in some cases instead of encouragind creativity, inhibits
it~\cite{sutton1996brainstorming,mullen1991productivity}

As part of the \bb{pre-project}(see section~\ref{methodology:timeline}) the team
decided to use this methodology and do a brainstorming session to define what
kind of problem should be solved with blockchain. Many ideas emerged and were
captured into a white board without discrimination, no matter how hard or easy
to implement they were.

After saying enough ideas to fill the board we filtered the ones that were
impossible to achieve. Then, each one voted the best three, making a ranking of
the 3-4 best projects to start working on. Some of the ideas we came up to were
creating a distributed \emp{wikipedia} with governance models, an application to
contact people from minority groups in countries where they are persecuted
collectives, a distributed and community driven NGO\footnote{Non-governmental
  organization}, and a crowdfunding platform for \emph{whisteblowers}\footnote{A
  person who exposes any kind of information or activity that is deemed
  illegal}.

Finally we decided to create an approach to a distributed platform for open
science which we initially called Alexandria, in honor of Alexandra Elbakyan,
the creator of Sci-hub. Nevertheless we changed the name of the project to
Decentralized Science because there were a similar project about distributed
system for media files using blockchain with the same
name\footnote{https://www.alexandria.io/}.

\subsection{Value proposition canvas}
\label{sec:value-prop-canv}

\figura{vpc.jpg}{width=0.9\linewidth}{vpcimage}{Image of the value proposition
  canvas after the session}

A value proposition canvas is a tool to create, design and implement a product
idea. This method is commonly used by businesses and entrepreneurs to find the
balance between customer profile and product design, but there are other cases
of use for this tool outside business
scope~\cite{pokorna2015value,meertens2012mapping}.

The process is divided in two parts, customer profile and value map, each of
these divided in other three parts:~\cite{osterwalder2014value}:

\begin{itemize}
\item \textbf{Customer profile:} The goal of this step is to identify the
  profile of the final user of the platform. This section is divided in three
  parts: 1) \emph{Customer jobs:} things the customer are trying to get done, 2)
  \emph{Customer pains:} undesired costs and situations, 3) \emph{Customer
    gains:} benefits, social gains and cost savings expected.
\item \textbf{Value Map:} This section is about what the final product has to
  have and what does not, and its also divided in: 1) \emph{Product and
    services:} which products and services are offered that help the customer to
  get a job done, 2) \emph{Pain relievers:} how the customer pains are going to
  be alleviated, 3) \emph{Gain creators:} how the products and services create
  customer gains.
\end{itemize}

We decided to use this methodology in the \bb{pre-project} (see
section~\ref{methodology:timeline}) for the definition of the final platform,
since it established the general development framework of the application. As a
result, the following items were the most relevant of the project's Value
Proposition Canvas (see figure~\ref{vpcimage}):

\begin{itemize}
  \itbf{Customer Jobs:} Get recognition as researcher, share a research work,
  collaborate with peers, build a professional network, publish papers, be able
  to finish a researcher's PhD.

  \itbf{Customer Pains:} Slow reviews, publish in indexed journals,
  non-transparent process, takes more time than other jobs, low salaries.

  \itbf{Customer Gains:} Get to know other researchers, get knowledge, love for
  a research field, impact in the world, recognition as researcher.

  \itbf{Product and services:} Paper auto-formatter, Facebook of researchers,
  distributed journal, automated state of the art generator, universal
  publishing platform, Github for researchers.

  \itbf{Pain relievers:} Reviewer reputation, faster reviews, get donations for
  research, public and fair reviews, easier accreditation system.

  \itbf{Gain creators:} Free knowledge, open access, automatic review, find
  people in a research field, easier communication.
\end{itemize}

\subsection{Agile methodologies}
\label{sec:agile-methodologies}

Traditional software development methodologies are being replaced by the
so-called agile methodologies. These methodologies are characterized by
continuous integration, iterative development and the ability to assume changes
in business requirements~\cite{boehm2005management,livermore2008factors}.

One of the most popular is known as \bb{Extreme
  Programming}~\cite{lindstrom2004extreme} based on a series of basic concepts
when carrying out the development of a program: code simplicity and rapid
prototyping, continuous customer communication with the development team,
responsibility of the code of all the members of the group, short and quick
meetings, refactoring and continuous integration~\cite{theunissen2005search}.

Another well-known method within agile methodologies is
\bb{SCRUM}~\cite{rising2000scrum}, which uses two week windows to perform
development sprints and planning meetings. The use of these methodologies allow
developers to create better quality software in shorter periods of time. They
are designed for small teams from three to nine developers.

These two methodologies were a great influence to the methodology used to
achieve the \bb{project implementation} (see
section~\ref{methodology:timeline}). Programming smart contracts in Ethereum is
a difficult task because once the source code is deployed in the blockchain,
there is no way to change it. For this reason, the methodology used allowed me to
develop small prototypes and run several test for each one. Every two weeks I
started a development cycle consisting on programming the next prototype in the
first week and running tests in the second week.

During the whole \bb{project implementation} phase, meetings were held with the
thesis directors twice a month to discuss the progress made and set short-term
objectives.

As a complement to the previous methodologies, \bb{Kanban} was used to manage
the status of the project throughout the development process. Kanban was created
by the company Toyota to be able to see the status of a project in an easy and
fast way, but nowadays it is widely used in the field of software
engineering~\cite{ahmad2013kanban}. Web services like
Trello\footnote{https://trello.com/} or Github project
boards\footnote{https://help.github.com/articles/about-project-boards/} feature
a digital Kanban to carry out this development process and both were used in
Decentralized Science.

\section{Technology}
\label{tech}

The proposed system relies upon two emerging distributed technologies. On the
one hand, the Blockchain~\cite{buterin2014ethereum} provides a public
decentralized ledger to record the system's interactions. On the other hand,
IPFS~\cite{benet_ipfs-content_2014} is a distributed file system to store all
the papers and reviews sent to the platform. This ensures that all the
information is persistent, free, accessible, and does not rely on a centralized
server.

% -------------------------------------------------------------------
\subsection{IPFS}
% -------------------------------------------------------------------
\label{tech:sec:ipfs}

IPFS stands for Interplanetary File System. It is a peer-to-peer file-sharing
protocol that uses a cryptographic hashes to store files in a distributed
network. IPFS works very similar to the HTTP protocol but in a BitTorrent way.
It can be seen as a giant git repository where everyone can store, share and
exchange files~\cite{benet2014ipfs}.

\subsubsection*{IPFS on Decentralized Science}

IPFS provides a robust, distributed and secure way to store files in a
decentralized network. These files are identified by a string of characters and
each identifier is unique. In order to achieve this, IPFS computes the hash of
the data inside the file (a cheap computational operation) and uses this hash as
its identifier. It behaves like a link within the IPFS network that allows users
to identify and recover the file.

This feature implies that two identical data files have the same hash, so they
have the same IPFS address, eliminating duplicates in an easy, secure and fast
way.

IPFS merges four main ideas: Distributed Hash Tables, BitTorrent, Git and
Self-Certified Systems.

\subsubsection*{Distributed Hash Tables}
\label{tech:sec:ipfs:dht}

A distributed hash table (\emph{DHT}) is a decentralized structure that works
very similar to a hash table. It consists on a table that behaves as a
collection of keys (hash strings) that identify items in a distributed database.
The table performs simple mathematical operations generating a random string
called \emph{hash}. The hash acts as a pointer that directs to the table's
information, allowing users to find it in a large database without performing an
exhaustive search~\cite{kaluszka2010distributed}.

In distributed hash tables, hash strings are keys that identify a value in one
or more nodes. Any node can use a key to retrieve data. This system includes a
data structure called ``keyspace'' that is the set of all possible keys, which
is broadcasted across the nodes in the system. The mapping of the keys is made
by a function that calculates the \ii{keyspace} of each node and shares it with
its neighbors. These nodes also have and identifier and a set of identifiers
pointing to all its neighbors nodes. If a node is removed from the network, only
a small portion of the data must be recovered by other
nodes\cite{kaluszka2010distributed}.

This system makes \emph{DHTs} scalable, fast and robust. It is used by
frameworks such as Tapestry \cite{zhao2004tapestry}, Chord
\cite{stoica2001chord}, Kelips \cite{gupta2003kelips}, Kademlia
\cite{maymounkov2002kademlia} and IPFS \cite{benet2014ipfs}. These platforms are
similar in cost and performance if they are tested in a large enough network.
They behave very fast when it comes to searching for a key through massive
networks of nodes~\cite{li2004comparing}, that's why it is used by IPFS to
create its distributed file system.

\subsubsection*{BitTorrent - File sharing}
\label{tech:sec:ipfs:bt}
BitTorrent~\cite{cohen2003incentives} is a P2P file sharing system used
worldwide. In this system, files are divided into very small chucks of data, and
are shared in a peer-to-peer network. Each peer aims to maximize its download
rate by connecting to the best peers, meaning that peers with faster network
speed will be better than ones with slow connectivity. In BitTorrent's network,
peers with high upload rate will get higher download rate, so the key is
balancing the network bandwidth between downloading and uploading
files~\cite{pouwelse2005bittorrent}.

IPFS uses three main features from BitTorrent's protocol~\cite{benet2014ipfs}:
\begin{itemize}
\item BitTorrent's data exchange protocol rewards nodes who contribute to the
  network, and punishes the ones who don't.
\item BitTorrent tracks the availability of file chunks, sending the rarest
  first rather than sending the most common ones.
\item IPFS uses PropShare~\cite{levin2008bittorrent}, an alternative
  implementation of the original BitTorrent protocol designed to maximize
  network speed. This implementation improves the previous bandwidth allocation
  strategy for each peer, enhancing the download and upload speed of the
  network.
\end{itemize}

\subsubsection*{Git - Version control system}
\label{tech:sec:ipfs:git}

A Version Control System (\ii{VCS}) is a software to manage changes in a
document, computer programs or any information. Each change is called revision
and it is identified by a number, the person who did it and a timestamp. In a
\ii{VCS} revisions can be reverted to a previous version, making them useful for
software development.

Git is a distributed \emph{VCS}~\cite{torvalds2010git} that was born in 2005,
when the development process of the Linux kernel lost its version control
system. The Linux kernel is one of the biggest free software projects nowadays.
It has a great team of developers behind and the code usually changes very
frequently. In 2002 the team used BitKeeper\footnote{BitKeeper is an and
  distributed and scalable \ii{VCS} available at https://www.bitkeeper.org/} as
\ii{VCS} since they had a free license. But in 2005 when this license was over,
Linus Torvalds decided to develop his own \ii{VCS}~\cite{spinellis2005version}.

Git was designed to be scalable and distributed, and nowadays is widely used by
the open source community. The most important factors that IPFS inherits from
Git are~\cite{benet2014ipfs}:

\begin{itemize}
\item Git reflects changes in a file system in a distributed way using an
  acyclic graph, in which each revision is a node and each change is an arc.
\item Objects are identified by the cryptographic hash of their contents.
\item Version changes only update preferences and add objects. To broadcast
  version changes, git only needs to transfer the new objects and update the
  remote references.
\end{itemize}

\subsubsection*{Self-Certifying File Systems}
\label{tech:sec:ipfs:scfs}

A self-certifying file system (\emph{SCFS}) is a secure and decentralized file
system that uses public keys to map file names, separating key management from
file system security. Servers have a public key and clients use the server
public key to authenticate the server and establish a secure communication
channel. Once the client has verified the server a secure channel is established
and the actual file access takes place~\cite{mazieres2000self}.

IPFS tries to connect these ideas into a cohesive, trustful and decentralized
file system. It is build on top of a peer-to-peer network, so no nodes are
privileged, and all of those store IPFS objects in local storage. These objects
represent files or other data structures.

In Decentralized Science, we use this technology to store all the files in a
robust and secure way, without relying on a centralized server. All these
characteristics provides a persistent platform, since IPFS works on a network of
thousands of nodes.

\subsection{Ethereum}
\label{tech:sec:ethereum}

As seen in the section~\ref{tb:eth}, Ethereum is a technology that allows its
users to create fully decentralized and autonomous applications. These
applications (called DApps) are smart contracts that are uploaded to the
Ethereum blockchain, so it is not necessary to have a server to run or
communicate with these contracts.

Ethereum is used as \ii{backend} in Decentralized Science. All the internal
operation of the platform is programmed in a smart contract and is executed from
the blockchain. This implies several important features:

\begin{itemize}
  \itbf{Open source:} All the source code uploaded to Ethereum is free, public
  and anyone can fork it in other projects.

  \itbf{Auditable interactions:} All calls and interactions to the platform are
  registered in the blockchain, making the entire process of scientific
  publication auditable.

  \itbf{Distributed platform:} All the source code is executed in the Ethereum's
  distributed network, meaning that Decentralized Science does not need a
  centralized server or a third party service to run the platform.

  \itbf{Free access to information:} Anyone can access to the platform's
  information (journals, authors, papers, reviews and reputation) without any
  cost and through a web page.
\end{itemize}

With Ethereum and IPFS, Decentralized Science is a 100 \% distributed platform,
open source and free\footnote{Interactions with the platform may have
  transaction costs within the Ethereum network (see section~\ref{arch:trans})
  \nopagebreak} to all users.


\subsection{Remix}
\label{sec:remix}

\figura{remix.png}{width=0.95\linewidth}{tech:sec:remix:sc}{Remix smart contract
  web compiler}Remix\footnote{https://remix.ethereum.org/} is an online smart
contract web compiler designed by the Ethereum community that allows users
create, compile and deploy contracts both in a test net or in the Ethereum's
blockchain.

This compiler offers the possibility to try the functionality of the contracts
through a virtual machine that simulates the blockchain's behavior called EVM
(\emph{Ethereum Virtual Machine})~\cite{hildenbrandt2017kevm}. When deploying a
contract with this platform, a series of HTML elements are generated, simulating
a real deployment and allowing developers to interact with the contract, without
the need of developing a front-end to test the contract behavior.

Remix also has a series of interesting features: a debugger to follow the
execution process of a transaction, a gas calculator that estimates the gas cost
of each transaction, a code analizer to detect possible vulnerabilities and an
ABI export system (see section \ref{jsmm}).

This tool facilitate the process of developing smart contracts, since the web
service allows to try different implementations of the same contract doing only
small changes, without the need of installing any software (see figure
~\ref{tech:sec:remix:sc}).

\subsection{Testrpc}
\label{testrpc}

\figura{testrpc.png}{width=0.7\linewidth}{testrpc:sc}{Transactions mined by
  testrpc in a test network}

Testrpc is a Node.js based Ethereum client for testing a development. It
simulates an Ethereum client behavior using the ethereum.js library. Once
installed through \code{npm}, it can be lauched through the linux terminal with
the command \code{testrpc} and offers the developers a series of interesting
features:

\begin{itemize}
  \itbf{Simulate accounts:}
  Testrpc\footnote{https://www.npmjs.com/package/ethereumjs-testrpc} default
  command launches 5 accounts, but it offers the possibility to add as many as
  needed with the option ``--accounts'', this allowed this project to simulate
  the interaction of 1000 accounts communicating with the contracts''. Example:
  \code{testrpc -a 1000}

  \itbf{View transactions:} Once testrpc is lauched, developers can see through
  the console all the transactions made with the blockchain in a user-friendly
  way. It also has a gas\footnote{Amount of money needed to execute a
    transaction (see section~\ref{ts:at})} estimator, a tool that calculate the
  price of each transaction (see figure \ref{testrpc:sc}).

  \itbf{Create test net:} Testrpc creates a test net through the port 8545. Any
  user in the internet using Metamask (see section \ref{jsmm}) can connect to
  this test net and interact with the contracts deployed.

  \itbf{Give ETH to an existing account:} If an user already has an Ethereum
  account and wants to connect a testrpc node, the administrator can assign ETH
  to that account to allow the user do transactions in the test net.
\end{itemize}

\subsection{JavaScript and Metamask}
\label{jsmm}

In order to interact with a smart contract in Ethereum, users normally use a web
application connected to the contract address (see section~\ref{ts:at}).
Nevertheless, the web application must be connected to an Ethereum node in order
to communicate with it. There are two different ways to achieve this. The first
one is to install an specialized web browser like
AlethZero\footnote{https://github.com/ethereum/alethzero},
Mist\footnote{https://github.com/ethereum/mist} or
Brave\footnote{https://brave.com/} that provides the libraries needed to
interact with smart contracts and connects to the blockchain automatically. The
second one is installing an extension like
Metamask\footnote{https://metamask.io/} as an extension of the web browser.


Metamask is a web browser extension (available for Chrome, Firefox, and Opera)
that allows its users to connect both to the Ethereum network or a custom test
net. It contains the mechanisms needed to make transactions and communicate with
smart contracts in the blockchain. To use it, users only need to install the
extension from the Metamask homepage and configure it with an Ethereum account.
Metamask also allows the creation of new accounts, but in order to make
transactions with the main Ethereum blockchain, these accounts must have enough
funds.

Thus, Metamask not only acts as a bridge between a web browser and the Ethereum
network, it also works as a wallet and supports Ethereum's official tokens. In
order to make transactions with Metamask through a web page, this web page
should use JavaScript.

JavaScript is used to connect to a smart contract address and be able to call to
specific functions of it. To do so, the JavaScript code must have two important
data:

\begin{itemize}
\item \textbf{Ethereum's contrat address:} When the user loads the web page to
  connect to the contract, JavaScript must have the address in which it is
  stored, because all the interactions with the platform are made through
  transactions to this address.
\item \textbf{Contract's ABI:} An ABI (Application Binary Interface) is a data
  structure in which JavaScript can find all the methods a contract provides.
  Each method defines its inputs, outputs, type, if its payable and a state.
  JavaScript uses this information to build the transactions to call these
  methods (see listing \ref{abi}).

\end{itemize}

These two technologies were used to test the platform proposed in this work,
using HTML and Testrpc to simulate a functional journal (see chapter~\ref{poc})


\input{Capitulos/listing_abi.tex}


\subsection{Github}
\label{sec:github}

Github\footnote{https://github.com} is a web hosting service for \ii{VCS} using
Git (see section~\ref{tech:sec:ipfs:git}). If offers all Git features as well as
its own features like bug tracking, issues and task management, kanban boards,
wiki pages among others.

Decentralized Science is 100\% open software and uploaded to Github. All the
source code, documents, web page, and all the information is available at:

\begin{lstlisting}[frame=single]
  https://github.com/DecentralizedScience/
\end{lstlisting}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../Tesis.tex"
%%% End:
